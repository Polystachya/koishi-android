# ğŸš€ GitHub Actions å·¥ä½œæµä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®æä¾›å¤šä¸ªå·¥ä½œæµæ¥æ”¯æŒä¸åŒçš„æ„å»ºå’Œå‘å¸ƒéœ€æ±‚ï¼Œç¡®ä¿åœ¨æ²¡æœ‰æœ¬åœ°æ„å»ºç¯å¢ƒçš„æƒ…å†µä¸‹ä¹Ÿèƒ½ç¨³å®šå‘å¸ƒ APKã€‚

## ğŸ“‹ å·¥ä½œæµæ¦‚è§ˆ

| å·¥ä½œæµ | ä¸»è¦ç”¨é€” | è§¦å‘æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|--------|----------|----------|----------|
| `test-build.yml` | æµ‹è¯•æ„å»ºéªŒè¯ | æ‰‹åŠ¨/PR/æ¨é€ | å¼€å‘æµ‹è¯•ã€CIéªŒè¯ |
| `upload.yml` | æ­£å¼/é¢„å‘å¸ƒæ„å»º | Releaseåˆ›å»º/æ‰‹åŠ¨ | å‘å¸ƒæ„å»ºã€é¢„å‘å¸ƒæµ‹è¯• |
| `release.yml` | ç‰ˆæœ¬å‘å¸ƒç®¡ç† | æ‰‹åŠ¨ | åˆ›å»ºæ­£å¼ç‰ˆæœ¬å· |

## ğŸ§ª æµ‹è¯•æ„å»º (`test-build.yml`)

### è§¦å‘æ–¹å¼

#### 1. æ‰‹åŠ¨è§¦å‘ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰
```bash
# åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘
# è¾“å…¥å‚æ•°ï¼š
# - build_type: test/preview/rc
# - version_suffix: beta1/rc2 (å¯é€‰)
# - upload_artifacts: true/false
```

#### 2. è‡ªåŠ¨è§¦å‘
- **Pull Request**: å½“ PR æ¶‰åŠæ„å»ºç›¸å…³æ–‡ä»¶æ—¶è‡ªåŠ¨è§¦å‘
- **åˆ†æ”¯æ¨é€**: æ¨é€åˆ° `android-fixes` æˆ– `develop` åˆ†æ”¯æ—¶è§¦å‘

### ç‰ˆæœ¬å·è§„åˆ™
- **PR æ„å»º**: `test-pr123` (ç‰ˆæœ¬ç : 900123)
- **åˆ†æ”¯æ„å»º**: `test-fixes-1a2b3c4` (ç‰ˆæœ¬ç : 8002b3c4)
- **æ‰‹åŠ¨æ„å»º**: `test-202312151030-beta1` (ç‰ˆæœ¬ç : 71030)

### äº§ç‰©
- âœ… ç­¾ååçš„ APK æ–‡ä»¶
- âœ… åŸºæœ¬éªŒè¯ï¼ˆæ–‡ä»¶å¤§å°ã€æ ¼å¼æ£€æŸ¥ï¼‰
- âœ… 30å¤©ä¿å­˜æœŸçš„ Artifacts
- âœ… è¯¦ç»†çš„æ„å»ºæ‘˜è¦

## ğŸ“¦ å‘å¸ƒæ„å»º (`upload.yml`)

### è§¦å‘æ–¹å¼

#### 1. è‡ªåŠ¨è§¦å‘ï¼ˆæ­£å¼å‘å¸ƒï¼‰
```bash
# å½“ release.yml åˆ›å»ºæ–° Release æ—¶è‡ªåŠ¨è§¦å‘
# æ„å»ºå¯¹åº”ç‰ˆæœ¬çš„æ­£å¼ APK
```

#### 2. æ‰‹åŠ¨è§¦å‘ï¼ˆçµæ´»æ§åˆ¶ï¼‰
```bash
# åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘
# è¾“å…¥å‚æ•°ï¼š
# - target_release: v0.0.13 (ç•™ç©ºä½¿ç”¨æœ€æ–°)
# - build_purpose: release/prerelease/test
```

### æ„å»ºç±»å‹

#### ğŸ¯ Release (æ­£å¼å‘å¸ƒ)
- **ç‰ˆæœ¬ç **: æ­£å¸¸ç‰ˆæœ¬å·ï¼ˆå¦‚ 00013ï¼‰
- **æ–‡ä»¶å**: `koishi-android-v0.0.13.apk`
- **ä¸Šä¼ **: åˆ° GitHub Release é¡µé¢
- **ç”¨é€”**: æ­£å¼å‘å¸ƒç»™ç”¨æˆ·

#### ğŸš€ Prerelease (é¢„å‘å¸ƒ)
- **ç‰ˆæœ¬ç **: 9å‰ç¼€ï¼ˆå¦‚ 900013ï¼‰
- **æ–‡ä»¶å**: `koishi-android-v0.0.13-pre.apk`
- **ä¸Šä¼ **: åˆ° GitHub Release é¡µé¢ï¼ˆæ ‡è®°ä¸ºé¢„å‘å¸ƒï¼‰
- **ç”¨é€”**: å…¬å¼€æµ‹è¯•ã€RCç‰ˆæœ¬

#### ğŸ§ª Test (æµ‹è¯•)
- **ç‰ˆæœ¬ç **: 8å‰ç¼€ï¼ˆå¦‚ 800013ï¼‰
- **æ–‡ä»¶å**: ä½œä¸º Artifact ä¿å­˜
- **ä¸Šä¼ **: GitHub Actions Artifactsï¼ˆ7å¤©ï¼‰
- **ç”¨é€”**: å†…éƒ¨æµ‹è¯•ã€éªŒè¯æ„å»º

## ğŸ·ï¸ ç‰ˆæœ¬ç®¡ç† (`release.yml`)

### è§¦å‘æ–¹å¼
- **ä»…æ‰‹åŠ¨è§¦å‘**: ç¡®ä¿ç‰ˆæœ¬å·å—æ§

### åŠŸèƒ½
- âœ… è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·ï¼ˆv0.0.12 â†’ v0.0.13ï¼‰
- âœ… è¯­ä¹‰åŒ–ç‰ˆæœ¬éªŒè¯
- âœ… é‡å¤æ ‡ç­¾æ£€æŸ¥
- âœ… è‡ªåŠ¨ç”Ÿæˆ Release Notes
- âœ… å¹¶å‘æ§åˆ¶é˜²æ­¢é‡å¤åˆ›å»º

## ğŸ”„ æ¨èå·¥ä½œæµç¨‹

### ğŸ§ª å¼€å‘æµ‹è¯•é˜¶æ®µ
```mermaid
graph TD
    A[ä»£ç ä¿®æ”¹] --> B[æ¨é€åˆ° android-fixes]
    B --> C[è‡ªåŠ¨è§¦å‘ test-build.yml]
    C --> D[ä¸‹è½½ Artifacts æµ‹è¯•]
    D --> E[éªŒè¯åŠŸèƒ½æ­£å¸¸]
    E --> F[åˆ›å»º PR]
    F --> G[PR è‡ªåŠ¨è§¦å‘ test-build.yml]
    G --> H[å†æ¬¡éªŒè¯]
```

### ğŸš€ å‘å¸ƒå‡†å¤‡é˜¶æ®µ
```mermaid
graph TD
    A[ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯] --> B[æ‰‹åŠ¨è§¦å‘ test-build.yml]
    B --> C[é€‰æ‹© build_type=preview]
    C --> D[æµ‹è¯•é¢„è§ˆç‰ˆæœ¬]
    D --> E[éªŒè¯æ— é—®é¢˜]
    E --> F[æ‰‹åŠ¨è§¦å‘ release.yml]
    F --> G[åˆ›å»ºæ­£å¼ Release]
    G --> H[è‡ªåŠ¨è§¦å‘ upload.yml]
    H --> I[æ­£å¼å‘å¸ƒ]
```

### ğŸ”„ ç´§æ€¥ä¿®å¤æµç¨‹
```mermaid
graph TD
    A[å‘ç°ç´§æ€¥é—®é¢˜] --> B[ä¿®å¤ä»£ç ]
    B --> C[æ‰‹åŠ¨è§¦å‘ upload.yml]
    C --> D[é€‰æ‹© build_purpose=prerelease]
    D --> E[å¿«é€Ÿæ„å»ºæµ‹è¯•ç‰ˆ]
    E --> F[éªŒè¯ä¿®å¤]
    F --> G[æ‰‹åŠ¨è§¦å‘ release.yml]
    G --> H[æ­£å¼å‘å¸ƒ]
```

## ğŸ›ï¸ å‚æ•°è¯´æ˜

### test-build.yml è¾“å…¥å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `build_type` | é€‰æ‹© | test | test/preview/rc |
| `version_suffix` | æ–‡æœ¬ | '' | beta1/rc2ç­‰åç¼€ |
| `upload_artifacts` | å¸ƒå°” | true | æ˜¯å¦ä¸Šä¼ Artifacts |

### upload.yml è¾“å…¥å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `target_release` | æ–‡æœ¬ | '' | ç›®æ ‡ç‰ˆæœ¬å· |
| `build_purpose` | é€‰æ‹© | release | release/prerelease/test |

## ğŸ“± ç‰ˆæœ¬å·ç®¡ç†

### ç‰ˆæœ¬ç åˆ†é…è§„åˆ™
| èŒƒå›´ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| 00001-09999 | æ­£å¼å‘å¸ƒ | 00013 (v0.0.13) |
| 10000-19999 | ä¿ç•™ | - |
| 70000-79999 | æ‰‹åŠ¨æµ‹è¯• | 71030 |
| 80000-89999 | åˆ†æ”¯æ„å»º | 8002b3c4 |
| 90000-99999 | PRæ„å»º | 900123 |

### æ–‡ä»¶å‘½åè§„åˆ™
```
æ­£å¼ç‰ˆ: koishi-android-v0.0.13.apk
é¢„å‘å¸ƒ: koishi-android-v0.0.13-pre.apk
æµ‹è¯•ç‰ˆ: test-pr123.apk (Artifacts)
```

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

- âœ… æ‰€æœ‰æ„å»ºéƒ½ä½¿ç”¨ç›¸åŒçš„ç­¾åå¯†é’¥
- âœ… æµ‹è¯•æ„å»ºä¸ä¼šåˆ›å»ºæ­£å¼ Release
- âœ… ç‰ˆæœ¬å·å†²çªæ£€æŸ¥
- âœ… å¹¶å‘æ§åˆ¶é˜²æ­¢é‡å¤æ“ä½œ
- âœ… æœ€å°æƒé™åŸåˆ™

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ„å»ºå¤±è´¥**: æ£€æŸ¥ `test-build.yml` å…ˆéªŒè¯
2. **ç‰ˆæœ¬å†²çª**: `release.yml` ä¼šè‡ªåŠ¨æ£€æŸ¥
3. **ä¸Šä¼ å¤±è´¥**: ç¡®è®¤ Release å·²åˆ›å»º
4. **æƒé™é—®é¢˜**: æ£€æŸ¥ Secrets é…ç½®

### è°ƒè¯•æŠ€å·§
- æŸ¥çœ‹ Actions æ—¥å¿—çš„è¯¦ç»†è¾“å‡º
- ä½¿ç”¨ `test-build.yml` éªŒè¯ä»£ç 
- æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ç¬¦åˆè§„èŒƒ
- ç¡®è®¤æ‰€æœ‰å¿…è¦çš„ Secrets å·²é…ç½®

---

ğŸ’¡ **æç¤º**: å»ºè®®åœ¨æ­£å¼å‘å¸ƒå‰å§‹ç»ˆä½¿ç”¨ `test-build.yml` è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿æ„å»ºç¨³å®šå¯é ï¼